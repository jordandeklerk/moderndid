[workspace]
authors = ["Jordan de Klerk <jordan.deklerk@gmail.com>"]
description = "Scalable, GPU-accelerated difference-in-differences for Python."
channels = ["conda-forge"]
name = "moderndid"
platforms = ["linux-64", "osx-arm64", "osx-64"]
version = "0.1.1"

[tasks]

[dependencies]
numpy = ">=1.22.0"
scipy = ">=1.17"
polars = ">=1.0.0"
pyarrow = ">=8.0.0"
narwhals = ">=1.13.3"
statsmodels = ">=0.14.4"
prettytable = ">=3.10.0"

[feature.dev]
platforms = ["linux-64", "osx-arm64", "osx-64"]

[feature.dev.dependencies]
pytest = ">=7.0.0"
pytest-benchmark = ">=4.0.0"
pytest-cov = ">=4.0.0"
pytest-timeout = ">=2.0.0"

[feature.dev.pypi-dependencies]
pyfixest = ">=0.30.2"

[feature.dev.tasks]
tests-core = "pytest -m 'not slow' --ignore=tests/dask --ignore=tests/spark -vv"
tests-full = "pytest --ignore=tests/dask --ignore=tests/spark -vv"
tests-dask = "pytest tests/dask -m 'not slow' --timeout=120 -vv"
tests-spark = "pytest tests/spark --timeout=120 -vv"

[feature.docs]
platforms = ["linux-64", "osx-arm64", "osx-64"]

[feature.docs.dependencies]
sphinx = "*"
sphinx-book-theme = "*"
sphinx-copybutton = "*"
sphinx-design = "*"
numpydoc = "*"
jupyter-sphinx = "*"

[feature.docs.pypi-dependencies]
myst-parser = { version = ">=2.0.0", extras = ["linkify"] }
myst-nb = ">=1.0.0"

[feature.docs.tasks]
docs = "sphinx-build -d docs/_doctree docs/source docs/_build --color -v -bhtml"

[feature.didcont.pypi-dependencies]
formulaic = ">=1.1.0"

[feature.didhonest.pypi-dependencies]
cvxpy = { version = ">=1.3.0", extras = ["ECOS"] }

[feature.plots.pypi-dependencies]
plotnine = ">=0.14.0"

[feature.numba.dependencies]
numba = ">=0.57.0"

[feature.dask.dependencies]
dask = ">=2024.1.0"
distributed = ">=2024.1.0"

[feature.spark.pypi-dependencies]
pyspark = ">=3.4.0"

[feature.gpu]
platforms = ["linux-64"]

[feature.gpu.pypi-dependencies]
cupy-cuda12x = ">=13.0"

[feature.lint.dependencies]
pre-commit = ">=3.0.0"

[feature.lint.pypi-dependencies]
ruff = ">=0.11.7"
mypy = ">=1.0.0"

[feature.lint.tasks]
lint = "pre-commit run --all-files"

[feature.build.dependencies]
pip = "*"
flit = ">=3.4,<4"

[feature.build.pypi-dependencies]
moderndid = { path = ".", editable = true }

[feature.build.tasks]
package = "flit build"

[feature.validation]
platforms = ["linux-64", "osx-arm64", "osx-64"]

[feature.validation.dependencies]
r-base = "*"
r-did = "*"
r-drdid = "*"
r-jsonlite = "*"
glpk = "*"

[feature.validation.tasks]
setup-r = "bash scripts/setup.sh"
all = "pytest tests/validation/ -vv"
did = "pytest tests/validation/test_r_did.py -vv"
didcont = "pytest tests/validation/test_r_didcont.py -vv"
drdid = "pytest tests/validation/test_r_drdid.py -vv"
didinter = "pytest tests/validation/test_r_didinter.py -vv"
didtriple = "pytest tests/validation/test_r_didtriple.py -vv"
didhonest = "pytest tests/validation/test_r_didhonest.py -vv"
npiv = "pytest tests/validation/test_r_npiv.py -vv"

[environments]
dev = ["dev", "build", "didcont", "didhonest", "plots", "numba", "dask", "spark"]
docs = ["docs", "build", "didcont", "didhonest", "plots", "numba", "dask", "spark"]
check = ["lint"]
build = ["build"]
gpu = ["gpu"]
validation = ["dev", "build", "validation", "didcont", "didhonest", "plots", "numba", "dask", "spark"]
